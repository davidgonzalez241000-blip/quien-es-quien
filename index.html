<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>¿Quién es Quién? - Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@900&display=swap');
        
        /* ELIMINAR PARPADEO Y RESALTADO EN MÓVIL */
        * {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        body { 
            background-color: #334155; 
            margin: 0; 
            padding: 10px;
            min-height: 100vh;
            font-family: 'Inter', sans-serif;
            display: flex;
            align-items: center; 
            justify-content: center;
            overflow-x: hidden;
        }

        .main-card {
            background: #f1f5f9;
            width: 100%;
            max-width: 1100px;
            border-radius: 24px;
            padding: 20px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
        }

        @media (min-width: 1024px) {
            .grid-container {
                grid-template-columns: repeat(10, 1fr);
                gap: 14px;
            }
        }

        .char-card {
            position: relative;
            background: #475569;
            border-radius: 12px;
            aspect-ratio: 1 / 1; 
            touch-action: none;
            overflow: hidden;
            cursor: pointer;
        }

        .char-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            pointer-events: none;
        }

        .x-mark {
            display: none;
            position: absolute;
            inset: 0;
            background: rgba(15, 23, 42, 0.7);
            backdrop-filter: blur(2px);
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        .is-eliminated .x-mark { display: flex; }
        .is-eliminated .char-img { filter: grayscale(1) brightness(0.4); }

        #zoom-overlay {
            position: fixed;
            inset: 0;
            background: rgba(30, 41, 59, 0.95);
            backdrop-filter: blur(10px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        #zoom-overlay.active {
            display: flex;
            opacity: 1;
        }

        #zoom-box {
            width: 85vw;
            max-width: 450px;
            aspect-ratio: 1/1;
            background: white;
            padding: 8px;
            border-radius: 24px;
            transform: scale(0.85);
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
        }

        #zoom-overlay.active #zoom-box { transform: scale(1); }

        .victory-glow {
            box-shadow: 0 0 50px 20px rgba(234, 179, 8, 0.5);
            border: 4px solid #eab308;
        }

        .btn-reset {
            background: #ef4444;
            color: white;
            padding: 8px 16px;
            border-radius: 12px;
            font-weight: 900;
            font-size: 0.7rem;
            text-transform: uppercase;
        }
    </style>
</head>
<body>

    <div id="zoom-overlay" onclick="hideZoom()">
        <div id="zoom-box" onclick="event.stopPropagation()">
            <div id="victory-label" class="hidden absolute -top-12 left-0 right-0 text-center">
                <span class="bg-yellow-500 text-white px-6 py-2 rounded-full font-black text-xl tracking-widest animate-bounce inline-block">
                    ¡TU PERSONAJE!
                </span>
            </div>
            <img id="zoom-img" src="" class="w-full h-full object-cover rounded-2xl">
        </div>
    </div>

    <div class="main-card">
        <div class="flex flex-row justify-between items-center mb-6 px-1">
            <h1 class="text-2xl md:text-5xl lg:text-6xl font-black italic text-blue-600 uppercase tracking-tighter">
                ¿QUIÉN <span class="text-green-500 mx-1">ES</span> <span class="text-red-500">QUIÉN?</span>
            </h1>
            <button onclick="resetGame()" class="btn-reset">REINICIAR</button>
        </div>
        <div id="grid" class="grid-container"></div>
    </div>

    <script>
        const grid = document.getElementById('grid');
        const overlay = document.getElementById('zoom-overlay');
        const zoomImg = document.getElementById('zoom-img');
        const zoomBox = document.getElementById('zoom-box');
        const victoryLabel = document.getElementById('victory-label');
        let timer;
        let zoomActivo = false;
        let modoVictoria = false;

        // Bloqueo total de menús contextuales
        window.oncontextmenu = function(event) {
            event.preventDefault();
            event.stopPropagation();
            return false;
        };

        function hideZoom() {
            clearTimeout(timer);
            overlay.classList.remove('active');
            setTimeout(() => { 
                if (!overlay.classList.contains('active')) {
                    zoomActivo = false;
                    modoVictoria = false;
                    victoryLabel.classList.add('hidden');
                    zoomBox.classList.remove('victory-glow');
                }
            }, 200);
        }

        for (let i = 1; i <= 50; i++) {
            const card = document.createElement('div');
            card.className = "char-card";
            const imgSrc = `personajes/${i}.jpg`;
            
            card.innerHTML = `
                <img src="${imgSrc}" class="char-img" draggable="false">
                <div class="x-mark">
                    <svg viewBox="0 0 24 24" class="w-3/4 h-3/4 text-red-500" fill="none" stroke="currentColor" stroke-width="5">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </div>
            `;

            const showZoom = (isVictory = false) => {
                if (!isVictory && card.classList.contains('is-eliminated')) return;
                
                zoomActivo = true;
                zoomImg.src = imgSrc;
                
                if (isVictory) {
                    modoVictoria = true;
                    victoryLabel.classList.remove('hidden');
                    zoomBox.classList.add('victory-glow');
                }

                overlay.classList.add('active');
                if (navigator.vibrate) navigator.vibrate(isVictory ? [100, 50, 100] : 40);
            };

            // PC
            card.addEventListener('mouseenter', () => {
                if (!card.classList.contains('is-eliminated')) {
                    timer = setTimeout(showZoom, 650);
                }
            });
            card.addEventListener('mouseleave', () => { if(!modoVictoria) hideZoom(); });

            // MÓVIL - MEJORADO PARA EVITAR PARPADEO
            card.addEventListener('touchstart', (e) => {
                if (card.classList.contains('is-eliminated')) return;
                
                // Precarga la imagen inmediatamente al tocar
                zoomImg.src = imgSrc; 
                
                timer = setTimeout(() => {
                    showZoom();
                }, 400);
            }, {passive: true});

            card.addEventListener('touchmove', () => clearTimeout(timer), {passive: true});
            card.addEventListener('touchend', () => { if(!modoVictoria) hideZoom(); });

            // CLIC (LA X)
            card.addEventListener('click', (e) => {
                if (!zoomActivo) {
                    card.classList.toggle('is-eliminated');
                    checkVictory();
                }
            });

            grid.appendChild(card);
        }

        function checkVictory() {
            const allCards = document.querySelectorAll('.char-card');
            const eliminated = document.querySelectorAll('.is-eliminated');
            
            if (eliminated.length === 49) {
                const winner = Array.from(allCards).find(c => !c.classList.contains('is-eliminated'));
                if (winner) {
                    setTimeout(() => {
                        const winnerImg = winner.querySelector('img').src;
                        zoomImg.src = winnerImg;
                        modoVictoria = true;
                        victoryLabel.classList.remove('hidden');
                        zoomBox.classList.add('victory-glow');
                        overlay.classList.add('active');
                        if (navigator.vibrate) navigator.vibrate([100, 50, 100]);
                    }, 300);
                }
            }
        }

        function resetGame() {
            if(confirm('¿Reiniciar tablero?')) {
                document.querySelectorAll('.char-card').forEach(card => card.classList.remove('is-eliminated'));
                hideZoom();
            }
        }
    </script>
</body>
</html>
